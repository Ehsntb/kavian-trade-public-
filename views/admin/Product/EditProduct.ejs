<!-- Container-fluid starts-->
<!-- <div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div
          class="card-header pb-0 d-flex justify-content-between align-items-center border-bottom"
        >
          <h2 class="content-title card-title">ویرایش محصول</h2>
          <a href="/admin/products" class="btn btn-success me-auto"
            >بازگشت <b><i class="fa fa-angle-left me-2"></i></b
          ></a>
        </div>
        <div class="card-body">
          <form
            method="POST"
            action="/admin/updateproduct/<%= product.id %>"
            id="editProductFor"
          >
            <div class="row">
              <div class="col-lg-4">
                <label for="title" class="form-label">عنوان محصول *</label>
                <input
                  id="title"
                  type="text"
                  class="form-control"
                  name="title"
                  value="<%= product.title %>"
                  required
                />
              </div>

              <div class="col-lg-4">
                <label for="short_description" class="form-label"
                  >توضیحات خلاصه *</label
                >
                <textarea
                  id="short_description"
                  class="form-control"
                  name="short_description"
                  required
                >
<%= product.short_description %></textarea
                >
              </div>

              <div class="col-lg-4">
                <label for="main_image" class="form-label"
                  >آپلود تصویر شاخص *</label
                >
                <div class="mb-3">
                  <% if (product.gallery.find(g => g.is_main === 1)) { %>
                  <img
                    src="../../images/productsImages/<%= product.gallery.find(g => g.is_main === 1).image_url %>"
                    alt="Current Main Image"
                    class="img-fluid mb-2"
                    width="150"
                  />
                  <% } %>
                </div>
                <input
                  id="main_image"
                  type="file"
                  data="<%= product.gallery.find(g => g.is_main === 1).image_url %>"
                  class="form-control"
                  name="main_image"
                  accept="image/*"
                  multiple="false"
                />
              </div>

              <div class="col-lg-12">
                <label for="long_description" class="form-label"
                  >توضیحات کامل *</label
                >
                <textarea
                  id="long_description"
                  class="form-control"
                  name="long_description"
                  required
                >
<%= product.long_description %></textarea
                >
              </div>

              <div class="col-lg-12">
                <label class="form-label">آپلود تصاویر گالری</label>

                <div id="existingGalleryImages" class="mb-3">
                  <% product.gallery.forEach((image, index) => { if
                  (!image.is_main) { %>
                  <div class="row mb-2">
                    <div class="col-md-10">
                      <img
                        src="../../images/productsImages/<%= image.image_url %>"
                        alt="Gallery Image <%= index + 1 %>"
                        class="img-fluid mb-2"
                        width="150"
                      />
                    </div>
                    <div class="col-md-2">
                      <form
                        action="/admin/deleteimage/<%= image.id %>"
                        method="POST"
                        id="deleteByIdForm"
                      >
                        <button
                          type="submit"
                          class="btn btn-danger btn-sm removeImage"
                          data-image-url="<%= image.image_url %>"
                          data-id="<%= image.id %>"
                        >
                          حذف
                        </button>
                      </form>
                    </div>
                  </div>
                  <% } }) %>
                </div>

                <div id="galleryContainer">
                  <div class="row mb-2">
                    <div class="col-md-10">
                      <input
                        type="file"
                        class="form-control"
                        name="gallery_images[]"
                        accept="image/*"
                        multiple="false"
                      />
                    </div>
                  </div>
                </div>

                <button
                  type="button"
                  class="btn btn-secondary mt-2"
                  id="addImage"
                >
                  اضافه کردن تصویر
                </button>
              </div>

              <div class="col-lg-6">
                <label for="short_link" class="form-label"
                  >نام نمایشی محصول در URL *</label
                >
                <input
                  id="short_link"
                  type="text"
                  class="form-control"
                  name="short_link"
                  value="<%= product.short_link %>"
                  required
                />
              </div>

              <div class="col-lg-6">
                <label for="location" class="form-label"
                  >نام مکان پرورش یا تولید *</label
                >
                <input
                  id="location"
                  type="text"
                  class="form-control"
                  name="location"
                  value="<%= product.location %>"
                  required
                />
              </div>

              <div class="col-lg-12">
                <label class="form-label">دسته ها *</label>
                <select
                  id="categories"
                  class="form-control"
                  name="category_id"
                  required
                >
                  <% for (category of categories){ %> <% if (category.id ==
                  product.category_id){ %>
                  <option value="<%= category.id %>" selected>
                    <%= category.title %>
                  </option>
                  <% } else { %>
                  <option value="<%= category.id %>">
                    <%= category.title %>
                  </option>
                  <% } } %>
                </select>
              </div>

              <div class="col-lg-12 mt-3">
                <button type="submit" class="btn btn-primary">
                  ثبت تغییرات محصول
                </button>
              </div>
            </div>
          </form>
        </div>
        <div class="card-footer"></div>
      </div>
    </div>
  </div>
</div> -->

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header pb-0 d-flex justify-content-between align-items-center border-bottom">
          <h2 class="content-title card-title">ویرایش محصول</h2>
          <a href="/admin/products" class="btn btn-success me-auto">
            بازگشت <b><i class="fa fa-angle-left me-2"></i></b>
          </a>
        </div>
        <div class="card-body">
          <form method="POST" action="/admin/updateproduct/<%= product.id %>" enctype="multipart/form-data" id="editProductForm">
            <div class="row">
              <div class="col-lg-4">
                <label for="title" class="form-label">عنوان محصول *</label>
                <input id="title" type="text" class="form-control" name="title" value="<%= product.title %>" required />
              </div>

              <div class="col-lg-4">
                <label for="short_description" class="form-label">توضیحات خلاصه *</label>
                <textarea id="short_description" class="form-control" name="short_description" required><%= product.short_description %></textarea>
              </div>

              <div class="col-lg-4">
                <label for="main_image" class="form-label">آپلود تصویر شاخص *</label>
                <div class="mb-3">
                  <% if (product.gallery.find(g => g.is_main === 1)) { %>
                    <img src="../../images/productsImages/<%= product.gallery.find(g => g.is_main === 1).image_url %>" alt="Current Main Image" class="img-fluid mb-2" width="150" />
                  <% } %>
                </div>
                <input id="main_image" type="file" class="form-control" name="main_image" accept="image/*" />
              </div>

              <div class="col-lg-12">
                <label for="long_description" class="form-label">توضیحات کامل *</label>
                <textarea id="long_description" class="form-control" name="long_description" required><%= product.long_description %></textarea>
              </div>

              <div class="col-lg-12">
                <label class="form-label">آپلود تصاویر گالری</label>
                <div id="existingGalleryImages" class="row mb-2">
                  <% product.gallery.forEach((image, index) => { if (!image.is_main) { %>
                    <div class="col-lg-4 col-md-6 mb-3">
                      <div class="border p-3 text-center" style="width: 200px; height: 250px; border: rgba(36, 105, 92, 0.15); border-radius: 10%;"> <!-- Set default size for each box -->
                        <img src="../../images/productsImages/<%= image.image_url %>" alt="Gallery Image <%= index + 1 %>" class="img-fluid mb-2" style="max-height: 150px; object-fit: cover;" />
                        <form action="/admin/deleteimage/<%= image.id %>" method="POST" id="deleteByIdForm">
                          <button type="submit" class="btn btn-danger btn-sm removeImage" data-image-url="<%= image.image_url %>" data-id="<%= image.id %>">
                            حذف
                          </button>
                        </form>
                      </div>
                    </div>
                  <% } }) %>
                </div>

                <div id="galleryContainer">
                  <div class="row mb-2">
                    <div class="col-md-10">
                      <input type="file" class="form-control" name="gallery_images[]" accept="image/*" />
                    </div>
                  </div>
                </div>

                <button type="button" class="btn btn-secondary mt-2" id="addImage">اضافه کردن تصویر</button>
              </div>

              <div class="col-lg-6">
                <label for="short_link" class="form-label">نام نمایشی محصول در URL *</label>
                <input id="short_link" type="text" class="form-control" name="short_link" value="<%= product.short_link %>" required />
              </div>

              <div class="col-lg-6">
                <label for="location" class="form-label">نام مکان پرورش یا تولید *</label>
                <input id="location" type="text" class="form-control" name="location" value="<%= product.location %>" required />
              </div>

              <div class="col-lg-12">
                <label class="form-label">دسته ها *</label>
                <select id="categories" class="form-control" name="category_id" required>
                  <% for (let category of categories) { %>
                    <option value="<%= category.id %>" <%= category.id == product.category_id ? 'selected' : '' %>><%= category.title %></option>
                  <% } %>
                </select>
              </div>

              <div class="col-lg-12 mt-3">
                <button type="submit" class="btn btn-primary">ثبت تغییرات محصول</button>
              </div>
            </div>
          </form>
        </div>
        <div class="card-footer"></div>
      </div>
    </div>
  </div>
</div>

<!-- Container-fluid Ends -->

<!-- <script>
  // JavaScript to handle adding more gallery image inputs
  document.getElementById("addImage").addEventListener("click", function () {
    const galleryContainer = document.getElementById("galleryContainer");
    const newImageRow = document.createElement("div");
    newImageRow.className = "row mb-2";
    newImageRow.innerHTML = `
      <div class="col-md-10">
        <input type="file" class="form-control" name="gallery_images[]" accept="image/*">
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-danger btn-sm removeImage">X</button>
      </div>`;
    galleryContainer.appendChild(newImageRow);

    // Add event listener to remove button
    newImageRow
      .querySelector(".removeImage")
      .addEventListener("click", function () {
        newImageRow.remove();
      });
  });

  // Remove existing gallery images (this could trigger a backend deletion)
  // document.querySelectorAll(".removeImage").forEach((button) => {
  //   button.addEventListener("click", function () {
  //     const imageUrl = this.getAttribute("data-image-url");
  //     // Optionally send a request to remove this image from the server
  //     this.closest(".row").remove();
  //   });
  // });
</script> -->
